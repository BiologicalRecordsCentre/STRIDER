---
title: "An example with virtualspecies and NLMR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{An example with virtualspecies and NLMR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This is a slightly more complex example of how this package works.

```{r setup, eval = F}
library(STRIDER)
library(terra)
library(sf)

library(NLMR)
library(virtualspecies)

#set a seed so it's reproducible
set.seed(42)
```

First we create a background SpatRaster from which to use the extent, resolution, and CRS.

```{r state, eval = F}
# Create the simulation object
sim_obj <- SimulationObject(background = rast(matrix(0, 1000, 1000)))

#simulate a uniform state of the environment across the background (although in this example we don't actually use it)
sim_obj <- sim_state_env_NLMR(sim_obj,
                          c("mpd","mpd","mpd","random"),
                           list(
                             list(roughness=0.5),
                             list(roughness=0.6),
                             list(roughness=0.8),
                             list()
                             )
                           )

plot(sim_obj@state_env)

# Simulate a uniform state of the target across the background
sim_obj <- sim_state_target_virtualspecies(sim_obj, n_targets = 3)

#plot the state
plot(sim_obj@state_target)
```

Next we simulate effort across the landscape

```{r effort, eval = F}
# Simulate effort across the landscape
sim_obj <- sim_effort_uniform(sim_obj, n_visits = 100, replace = FALSE)

# Add the sampled locations to the plot
plot(sim_obj@effort$geometry)

```

Next we simulate detections and identifications

```{r detections, eval = F}
# Simulate detection and identification
sim_obj <- sim_detect_equal(sim_obj, prob = 0.5)

# Plot the non-detections
plot(sim_obj@detect$geometry[sim_obj@detect$detected == FALSE], col = "red", pch = 4)

```

We then simulate whether these detections made are reported

```{r reporting, eval = F}
# Simulate reporting
sim_obj <- sim_report_equal(sim_obj, prob = 0.8, platform = "iRecord")

# Color reported records as yellow
plot(sim_obj@report$geometry[sim_obj@report$reported], col = "yellow")
```

And we're done. let's have a look at all the objects we have created

```{r review, eval = F}
print(sim_obj@state_env)
print(sim_obj@state_target)
print(sim_obj@effort)
print(sim_obj@detect)
print(sim_obj@report)
```
