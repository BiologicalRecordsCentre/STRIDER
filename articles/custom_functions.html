<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>More complex simulations â€¢ STRIDER</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="More complex simulations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">STRIDER</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/custom_functions.html">More complex simulations</a></li>
    <li><a class="dropdown-item" href="../articles/example_minimal.html">A minimal example</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>More complex simulations</h1>
            
      

      <div class="d-none name"><code>custom_functions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates a simulation workflow to investigate the
benefits and issues of co-locating recording sites for different
taxonomic groups, such as butterflies, plants, and birds. We will
generate species counts/abundance data across multiple sites, simulate
dependencies between species, and incorporate temporal trends. This
approach helps assess whether using the same recording sites across
different taxa groups is beneficial or problematic and explore optimal
strategies for site co-location.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, we load the required packages and set a seed for
reproducibility.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://biologicalrecordscentre.github.io/STRIDER/">STRIDER</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.78</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:terra':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, union</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-environmental-state">Custom Environmental State<a class="anchor" aria-label="anchor" href="#custom-environmental-state"></a>
</h2>
<p>We define custom environmental variables with different spatial
patterns to simulate realistic scenarios.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dim_x</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">dim_y</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="co"># Define environmental variables with different spatial patterns</span></span>
<span><span class="va">env1</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="va">dim_x</span><span class="op">)</span>, times <span class="op">=</span> <span class="va">dim_y</span><span class="op">)</span>, <span class="va">dim_x</span>, <span class="va">dim_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">env1</span> <span class="op">&lt;-</span> <span class="va">env1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">env1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">env2</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">dim_x</span>, to <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">dim_y</span><span class="op">)</span>, <span class="va">dim_x</span>, <span class="va">dim_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">env2</span> <span class="op">&lt;-</span> <span class="va">env2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">env2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">env3</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">dim_x</span> <span class="op">*</span> <span class="va">dim_y</span><span class="op">)</span>, <span class="va">dim_x</span>, <span class="va">dim_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">env3</span> <span class="op">&lt;-</span> <span class="va">env3</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">env3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">env4</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">pi</span>, length.out <span class="op">=</span> <span class="va">dim_x</span><span class="op">)</span><span class="op">)</span>, <span class="va">dim_x</span>, <span class="va">dim_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">env4</span> <span class="op">&lt;-</span> <span class="va">env4</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">env4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">env5</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">pi</span>, length.out <span class="op">=</span> <span class="va">dim_y</span><span class="op">)</span><span class="op">)</span>, <span class="va">dim_x</span>, <span class="va">dim_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">env5</span> <span class="op">&lt;-</span> <span class="va">env5</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">env5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">custom_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">env1</span>, <span class="va">env2</span>, <span class="va">env3</span>, <span class="va">env4</span>, <span class="va">env5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">custom_env</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rainfall"</span>, <span class="st">"temperature"</span>, <span class="st">"urban_density"</span>, <span class="st">"elevation"</span>, <span class="st">"aspect"</span><span class="op">)</span></span></code></pre></div>
<p>Next, we integrate these custom environmental variables into the
simulation object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">background</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">dim_x</span>, <span class="va">dim_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim_obj</span> <span class="op">&lt;-</span> <span class="fu">SimulationObject</span><span class="op">(</span>background <span class="op">=</span> <span class="va">background</span><span class="op">)</span></span>
<span><span class="va">sim_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_state_env.html">sim_state_env</a></span><span class="op">(</span><span class="va">sim_obj</span>, spatraster <span class="op">=</span> <span class="va">custom_env</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-suitability-functions-for-multiple-species">Custom Suitability Functions for Multiple Species<a class="anchor" aria-label="anchor" href="#custom-suitability-functions-for-multiple-species"></a>
</h2>
<p>We define custom suitability functions for multiple species, each
influenced differently by the environmental variables.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom suitability function for multiple species</span></span>
<span><span class="va">custom_suitability_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">simulation_object</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Extract environmental variables from the simulation object</span></span>
<span>  <span class="va">env</span> <span class="op">&lt;-</span> <span class="va">simulation_object</span><span class="op">@</span><span class="va">state_env</span></span>
<span>  </span>
<span>  <span class="co"># Define the suitability functions for multiple species</span></span>
<span>  <span class="va">species_suitability_functions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    butterfly <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">env</span><span class="op">)</span> <span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">rainfall</span> <span class="op">*</span> <span class="va">env</span><span class="op">$</span><span class="va">temperature</span> <span class="op">+</span> <span class="va">env</span><span class="op">$</span><span class="va">urban_density</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span>,</span>
<span>    plant <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">env</span><span class="op">)</span> <span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">rainfall</span> <span class="op">+</span> <span class="va">env</span><span class="op">$</span><span class="va">temperature</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">env</span><span class="op">$</span><span class="va">urban_density</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span>,</span>
<span>    bird <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">env</span><span class="op">)</span> <span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">rainfall</span> <span class="op">+</span> <span class="va">env</span><span class="op">$</span><span class="va">elevation</span> <span class="op">+</span> <span class="va">env</span><span class="op">$</span><span class="va">aspect</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span>,</span>
<span>    mammal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">env</span><span class="op">)</span> <span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">temperature</span> <span class="op">*</span> <span class="va">env</span><span class="op">$</span><span class="va">elevation</span> <span class="op">-</span> <span class="va">env</span><span class="op">$</span><span class="va">urban_density</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span>,</span>
<span>    amphibian <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">env</span><span class="op">)</span> <span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">rainfall</span> <span class="op">+</span> <span class="va">env</span><span class="op">$</span><span class="va">elevation</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">env</span><span class="op">$</span><span class="va">aspect</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Initialize an empty list to store the suitability layers</span></span>
<span>  <span class="va">suitability_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Loop through each species and calculate its suitability layer</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">species</span> <span class="kw">in</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">species_suitability_functions</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">suitability</span> <span class="op">&lt;-</span> <span class="va">species_suitability_functions</span><span class="op">[[</span><span class="va">species</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span>
<span>    <span class="va">suitability</span><span class="op">[</span><span class="va">suitability</span><span class="op">&lt;</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">suitability</span><span class="op">[</span><span class="va">suitability</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">suitability</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">species</span></span>
<span>    <span class="va">suitability_layers</span><span class="op">[[</span><span class="va">species</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">suitability</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Combine all suitability layers into a single SpatRaster object</span></span>
<span>  <span class="va">suitability_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">suitability_layers</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">suitability_raster</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sim_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_state_target_suitability.html">sim_state_target_suitability</a></span><span class="op">(</span><span class="va">sim_obj</span>, fun <span class="op">=</span> <span class="va">custom_suitability_function</span><span class="op">)</span></span></code></pre></div>
<p>Realised suitability</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_state_target_realise.html">sim_state_target_realise</a></span><span class="op">(</span><span class="va">sim_obj</span>,fun<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-effort-function">Custom Effort Function<a class="anchor" aria-label="anchor" href="#custom-effort-function"></a>
</h2>
<p>We create a custom effort function that simulates sampling effort
using a combination of urban density and random sampling.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_effort_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim_obj</span>, <span class="va">n_sites</span>, <span class="va">n_taxa_per_site</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/cells.html" class="external-link">cells</a></span><span class="op">(</span><span class="va">sim_obj</span><span class="op">@</span><span class="va">background</span><span class="op">)</span>, <span class="va">n_sites</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html" class="external-link">xyFromCell</a></span><span class="op">(</span><span class="va">sim_obj</span><span class="op">@</span><span class="va">background</span>, <span class="va">sites</span><span class="op">)</span></span>
<span>  <span class="va">effort_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">coords</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>    y <span class="op">=</span> <span class="va">coords</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">effort_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">effort_df</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">site_taxa_combination</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>sites <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sites</span>,target <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim_obj</span><span class="op">@</span><span class="va">state_target_suitability</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">effort_sf</span><span class="op">$</span><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim_obj</span><span class="op">@</span><span class="va">state_target_suitability</span><span class="op">)</span>, <span class="va">n_taxa_per_site</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">effort_sf</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sim_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_effort.html">sim_effort</a></span><span class="op">(</span><span class="va">sim_obj</span>, fun <span class="op">=</span> <span class="va">custom_effort_function</span>, n_sites <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-detection-and-reporting-functions">Custom Detection and Reporting Functions<a class="anchor" aria-label="anchor" href="#custom-detection-and-reporting-functions"></a>
</h2>
<p>We could define custom detection and reporting functions to introduce
variability in the detection and reporting probabilities, but just use
the default for now.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate the detection</span></span>
<span><span class="va">sim_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_detect.html">sim_detect</a></span><span class="op">(</span><span class="va">sim_obj</span>,fun <span class="op">=</span> <span class="st">"equal"</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate the reporting</span></span>
<span><span class="va">sim_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_report.html">sim_report</a></span><span class="op">(</span><span class="va">sim_obj</span>,fun <span class="op">=</span> <span class="st">"equal"</span>, prob <span class="op">=</span> <span class="fl">0.8</span>, platform <span class="op">=</span> <span class="st">"iRecord"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="custom_functions_files/figure-html/visualisation-1.png" width="700"><img src="custom_functions_files/figure-html/visualisation-2.png" width="700"><img src="custom_functions_files/figure-html/visualisation-3.png" width="700"><img src="custom_functions_files/figure-html/visualisation-4.png" width="700"><img src="custom_functions_files/figure-html/visualisation-5.png" width="700"><img src="custom_functions_files/figure-html/visualisation-6.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Rolph.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
